<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üßæ Invoice Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f4f6f8; padding: 0; margin: 0; }
    .container { max-width: 600px; margin: 20px auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #2c3e50; }
    button { width: 100%; padding: 12px; background: #3498db; color: white; font-size: 16px; border: none; border-radius: 6px; margin: 10px 0; }
    input[type="file"] { width: 100%; margin: 10px 0; padding: 10px; border: 2px dashed #aaa; border-radius: 8px; }
    img { max-width: 100%; margin-top: 10px; }

    #scanner-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 400px;
  box-sizing: border-box;
  border: 4px dashed rgba(255, 255, 255, 0.8);
  border-radius: 12px;
  pointer-events: none;
  z-index: 2;
}

#scanner-overlay::before {
  content: '';
  position: absolute;
  top: 20%;
  left: 10%;
  width: 80%;
  height: 60%;
  border: 3px solid #00e676; /* bright green scanning box */
  box-sizing: border-box;
  border-radius: 8px;
}

  </style>
</head>
<body>
<div class="container">
  <h2>üìÑ Scan Your Invoice</h2>
  <button onclick="startCamera()">üì∑ Take Photo</button>
  
  <form id="upload-form" action="/upload" method="POST" enctype="multipart/form-data">
    <input type="file" name="invoice_file" accept="image/*,.pdf" onchange="handleUpload(this)" required />
  </form>

  <!-- Webcam Panel -->
  <!-- Webcam Panel -->
<!-- Webcam Scanner Panel -->
<div id="camera-container" style="display:none; position: relative; margin-top: 15px;">
  <video id="video" autoplay playsinline style="width: 100%; height: 400px; border-radius: 12px;"></video>
  
  <!-- üî≤ Overlay Frame -->
  <div id="scanner-overlay"></div>

  <button onclick="capturePhoto()" style="margin-top: 10px;">üì∏ Capture</button>

  <canvas id="canvas" style="display:none;"></canvas>
  <form id="photo-upload-form" action="/upload" method="POST" enctype="multipart/form-data">
    <input type="hidden" name="camera_image" id="camera-image-input">
  </form>
</div>



  <div id="preview-container" style="display:none;">
    <h4>Preview:</h4>
    <img id="preview-img" />
    <button onclick="submitUploadedImage()">‚úÖ Submit</button>
    <button onclick="resetPreview()">üîÅ Retake</button>
  </div>
</div>

<script>
function startCamera() {
  document.getElementById("camera-container").style.display = "block";
  const video = document.getElementById("video");
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => { video.srcObject = stream; });
}

function capturePhoto() {
  const canvas = document.getElementById("canvas");
  const video = document.getElementById("video");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video, 0, 0);
  const imageData = canvas.toDataURL("image/png");

  document.getElementById("preview-img").src = imageData;
  document.getElementById("preview-container").style.display = "block";
  document.getElementById("camera-image-input").value = imageData;
}

function handleUpload(input) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function (e) {
    document.getElementById("preview-img").src = e.target.result;
    document.getElementById("preview-container").style.display = "block";
  };
  reader.readAsDataURL(file);
}

function submitUploadedImage() {
  const cameraImage = document.getElementById("camera-image-input").value;
  if (cameraImage) {
    document.getElementById("photo-upload-form").submit();
  } else {
    document.getElementById("upload-form").submit();
  }
}

function resetPreview() {
  document.getElementById("preview-container").style.display = "none";
  document.getElementById("camera-image-input").value = "";
}
</script>
</body>
</html>
